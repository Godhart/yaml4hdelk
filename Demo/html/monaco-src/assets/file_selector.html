<!DOCTYPE html>
<!-- Inspired with https://codepen.io/aardrian/pen/VoQbLm, https://adrianroselli.com/2019/09/table-with-expando-rows.html -->
<html lang="en">

<head>
    <meta charset="utf-8" />
    <title>Test for file browser</title>
    <link href="dark.css" rel="stylesheet">
</head>

<body class="tool">

    <script>
        const Add = "&#128932;"
        const Eye = "&#128065;"
        const Star = "&#9733;"
        const Pencil = "&#128393;"
        const Lock = "&#9919;"
        const CollapsedFolder = "&#128448;"
        const ExpandedFolder = "&#128449;"
        const Save = "&#128427;"
        const Delete = "&#10005;"
        const Reset = "&#9100;"
        const Warning = "&#9888;"
        const Stop = "&#11203;"
        const Reload = "&#10226;"
        const DocText = "&#128441;"
        const DocPic = "&#128443;"
        const Circle = "&#9679;"
        const Link = "&#11179;"

        // Populate table
        const filez = {
            "/file1": { "added": true, "timestamp": new Date().getTime() },
            "/folder0/file0-1": { "timestamp": new Date().getTime() - 60 },
            "/folder1/file1-1": { "modified": true, "fav": true, "timestamp": new Date().getTime() - 60 },
            "/folder1/file1-2": { "removed": true, "timestamp": new Date().getTime() - 120 },
            "/folder1/file1-3": { "renamed": true, "timestamp": new Date().getTime() - 240 },
            "/folder1/sub1/file1-1-1": { "timestamp": new Date().getTime() - 60 },
            "/folder1/sub2/file1-2-1": { "added": true, "fav": true, "timestamp": new Date().getTime() - 120 },
            "/folder2/file2-1": { "locked": true, "timestamp": new Date().getTime() - 300 },
            "/folder2/file2-2": { "flocked": true, "timestamp": new Date().getTime() - 360 },
            "/folder2/file2-3": { "locked": true, "modified": true, "outdate": true, "timestamp": new Date().getTime() },
            "/folder3/file3-1": { "added": true, "errors": ["Some error"], "timestamp": new Date().getTime() - 60 },
            "/folder3/file3-2": { "locked": true, "removed": true, "timestamp": new Date().getTime() - 120 },
            "/folder3/file3-2": { "flocked": true, "modified": true, "timestamp": new Date().getTime() - 120 },
            "/folder3/file3-3": { "locked": true, "modified": true, "open": true, "timestamp": new Date().getTime() - 240 },
            "/folder3/sub1/file3-1-1": { "open": true, "timestamp": new Date().getTime() - 60 },
            "/folder3/sub2/file3-2-1": { "fav": true, "timestamp": new Date().getTime() - 120 },
            "/folder4/file1-1": { "timestamp": new Date().getTime() - 300 },
            "/folder4/file1-2": { "errors": ["Error 1-2 1"], "timestamp": new Date().getTime() - 360 },
            "/folder4/file1-3": { "errors": ["Error 1-3 1", "Error 1-3 2"], "timestamp": new Date().getTime() - 360 },
            "/folder4/file1-4": { "timestamp": new Date().getTime() - 360 },
            "/folder4/file1-5": { "timestamp": new Date().getTime() - 360 },
            "/folder4/file1-6": { "timestamp": new Date().getTime() - 360 },
            "/folder4/sub1/file4-1-1": { "errors": ["Error 4-1-1 1"], "timestamp": new Date().getTime() - 60 },
            "/folder4/sub1/file4-2-1": { "errors": ["Error 4-1-1 2"], "timestamp": new Date().getTime() - 120 },
        }

        const folders = {}    // NOTE: folders are populated during table population
        const filesFilter = {
            "path": "",
            "locked": undefined,
            "flocked": undefined,
            "changed": undefined,
            "open": undefined,
            "fav": undefined,
            "outdate": undefined,
            "errors": undefined,
            "folders": undefined,
            "union": false,
        }

        function getPath(el) {
            while (true) {
                let path = el.getAttribute("data-path")
                if (path !== null) {
                    return path
                }
                if (el.parentNode === undefined && el.parentNode === null) {
                    break
                }
                el = el.parentNode
            }
            return null
        }

        function toggleFav(el) {
            const path = getPath(el)
            alert("toggleFav:" + path)
        }

        function toggleTab(el) {
            const path = getPath(el)
            alert("toggleTab:" + path)
        }

        function focusTab(el) {
            const path = getPath(el)
            alert("focusTab:" + path)
        }

        function saveChanges(el) {
            const path = getPath(el)
            alert("saveChanges:" + path)
        }

        function resetChanges(el) {
            const path = getPath(el)
            alert("resetChanges:" + path)
        }

        function addNode(el) {
            const path = getPath(el)
            alert("addNode:" + path)
        }

        function renameNode(el) {
            const path = getPath(el)
            alert("renameNode:" + path)
        }

        function deleteNode(el) {
            const path = getPath(el)
            alert("deleteNode:" + path)
        }

        function reloadNode(el) {
            const path = getPath(el)
            alert("reloadNode:" + path)
        }

        function lockNode(el) {
            const path = getPath(el)
            alert("lockNode:" + path)
        }

        function favNode(el) {
            const path = getPath(el)
            alert("favNode:" + path)
        }

        function showNodeErrors(el) {
            const path = getPath(el)
            alert("showNodeErrors:" + path)
        }

        function openNodeLink(el) {
            const path = getPath(el)
            alert("openNodeLink:" + path)
        }

        function toggleFolder(el) {
            const path = getPath(el)
            if (folders[path].expanded) {
                folders[path].expanded = false
            } else {
                folders[path].expanded = true
            }
            refreshView(filez, folders, filesFilter)
        }

        function toggleFolderFilter(el) {
            const path = getPath(el)
            const filter = document.getElementById("filePathFilter")
            if (filter.value == path) {
                filter.value = ""
            } else {
                filter.value = path
            }
            onFilterPathChange(filter.value)
        }

        function getFilterRow() {
            return document.getElementById('filtersRow')
        }

        function toggleAllFolder(el) {
            const fr = getFilterRow()
            let expanded = fr.getAttribute("data-folder-expanded") == "true"
            expanded = !expanded
            toggleFolderExpanded(expanded)
            fr.setAttribute("data-folder-expanded", "" + expanded)
            refreshView(filez, folders, filesFilter)
        }

        function toggleFolderExpanded(expanded) {
            for (const [folderPath, value] of Object.entries(folders)) {
                value.expanded = expanded
            }
        }

        function toggleFilter(filterField, filterAttribute) {
            const fr = getFilterRow()
            let value = fr.getAttribute(filterAttribute) == "true"
            value = !value
            if (value) {
                filesFilter[filterField] = true
            } else {
                filesFilter[filterField] = undefined
            }
            fr.setAttribute(filterAttribute, "" + value)
            updateFilter(filez, folders, filesFilter)
            refreshView(filez, folders, filesFilter)
        }

        function populate(table, filez, folders) {
            const foldersList = []
            for (const [filePath, value] of Object.entries(filez)) {
                value.path = filePath
                value.id = "file-" + filePath
                value.visible = true

                let folderPath = filePath.split('/').slice(0, -1).join('/')
                let folder = null
                if (folders[folderPath] === undefined) {
                    folders[folderPath] = {
                        "path": folderPath, "id": "folder-" + folderPath,
                        "filez": {}, "folders": {}, "folder": null, visible: true, "expanded": false
                    }
                    if (folderPath == "") {
                        folders[folderPath].expanded = true
                    }
                    foldersList.push(folderPath)
                    folder = folders[folderPath]
                    // Add folder row
                    if (folderPath != "") {
                        let folderRow = table.insertRow()
                        folder.row = folderRow
                        folderRow.setAttribute("data-folder", "true")
                        folderRow.setAttribute("data-path", folderPath)
                        folderRow.classList.add("shown")
                        folderRow.id = folder.id + "-row"
                        let cell = null

                        cell = folderRow.insertCell()
                        cell.innerHTML = '<button id="' + folder.id + '-icon" title="Collapse/Expand" class="tool-icon f-theme tool-icon-folder" onclick="toggleFolder(this)"></button>'

                        cell = folderRow.insertCell()
                        cell.innerHTML =
                            '<button id="' + folder.id + '-main" title="Toggle path filter" class="tool b-t tool-status-color" onclick="toggleFolderFilter(this)">' + folderPath + '</button>'
                        // TODO: +   '<button id="' + folder.id + '-enter" title="Enter folder" class="tool bf-t tool-folder-entry" onclick="enterFolder(this)">&#8628;</button>'

                        cell = folderRow.insertCell()
                        cell.innerHTML = '<button id="' + folder.id + '-status" title="Status" class="tool tool-f-status tool-status-color""></button>'
                        folder.stat_but = document.getElementById(folder.id + "-status")

                        cell = folderRow.insertCell()
                        cell.id = folder.id + "-nodeOps"
                        cell.innerHTML = "<span class='node-info'>\
<button class='tool tool-f-added'>A</button>\
<button class='tool tool-f-modified'>M</button>\
<button class='tool tool-f-renamed'>R</button>\
<button class='tool tool-f-removed'>D</button>\
</span>\
<span   id='" + folder.id + "-toolbox' class='toolbox'>" + '\
<button id="' + folder.id + '-add"     class="tool-icon x-add     " title="Add"              onclick="addNode(this)">&#128932;</button>\
<button id="' + folder.id + '-delete"  class="tool-icon x-delete  " title="Remove Folder"    onclick="deleteNode(this)">&#10005;</button>\
<button id="' + folder.id + '-rename"  class="tool-icon x-rename  " title="Move/Rename"      onclick="renameNode(this)">&#128393;</button>\
<button id="' + folder.id + '-save"    class="tool-icon x-save    " title="Save changes"     onclick="saveChanges(this)">&#128427;</button>\
<button id="' + folder.id + '-reset"   class="tool-icon x-reset   " title="Reset changes"    onclick="resetChanges(this)"></button>\
<button id="' + folder.id + '-lock"    class="tool-icon x-lock    " title="Lock"             onclick="lockNode(this)">&#9919;</button>\
' + "</span>"

                        cell = folderRow.insertCell()
                        cell.innerHTML = '\
<button id="' + folder.id + '-fav"     class="tool-icon tool-fav     " title="Favorite"         onclick="favNode(this)">&#9733;</button>'
                        folder.fav_cell = cell

                        cell = folderRow.insertCell()
                        cell.innerHTML = '\
<button id="' + folder.id + '-error"   class="tool-icon tool-error   " title="Errors"        onclick="showNodeErrors(this)">&#9888;</button>'
                        folder.err_but = document.getElementById(folder.id + "-error")

                        cell = folderRow.insertCell()
                    }
                } else {
                    folder = folders[folderPath]
                }

                value.folder = folder
                folder.filez[filePath] = value

                // Add file row
                let fileRow = table.insertRow()
                value.row = fileRow
                fileRow.setAttribute("data-file", "true")
                fileRow.setAttribute("data-path", filePath)
                fileRow.classList.add("shown")
                fileRow.id = value.id + "-row"
                let cell = null

                cell = fileRow.insertCell()
                cell.innerHTML = '<button id="' + value.id + '-icon" title="Focus Tab" class="tool-icon f-theme tool-icon-file" onclick="focusTab(this)"></button>'

                cell = fileRow.insertCell()
                cell.innerHTML = '<button id="' + value.id + '-main" title="Toggle Tab" class="tool b-t tool-text tool-status-color" onclick="toggleTab(this)">' + filePath + '</button>'

                cell = fileRow.insertCell()
                cell.innerHTML = '<button id="' + value.id + '-status" title="Status" class="tool tool-status tool-status-color""></button>'
                value.stat_but = document.getElementById(value.id + "-status")

                cell = fileRow.insertCell()
                cell.id = value.id + "-nodeOps"
                cell.innerHTML = "<span class='node-info f-greyed'>" + new Date(value.timestamp).toLocaleString() + "</span>\
<span   id='" + value.id + "-toolbox' class='toolbox'>" + '\
<button id="' + value.id + '-add"     class="tool-icon x-add     " title="Add"              onclick="addNode(this)">&#128932;</button>\
<button id="' + value.id + '-delete"  class="tool-icon x-delete  " title="Remove"           onclick="deleteNode(this)">&#10005;</button>\
<button id="' + value.id + '-rename"  class="tool-icon x-rename  " title="Move/Rename"      onclick="renameNode(this)">&#128393;</button>\
<button id="' + value.id + '-save"    class="tool-icon x-save    " title="Save changes"     onclick="saveChanges(this)">&#128427;</button>\
<button id="' + value.id + '-reset"   class="tool-icon x-reset   " title="Reset changes"    onclick="resetChanges(this)"></button>\
<button id="' + value.id + '-lock"    class="tool-icon x-lock    " title="Lock"             onclick="lockNode(this)">&#9919;</button>\
' + "</span>"

                cell = fileRow.insertCell()
                cell.innerHTML = '\
<button id="' + value.id + '-fav"     class="tool-icon tool-fav     " title="Favorite"      onclick="favNode(this)">&#9733;</button>'
                value.fav_cell = cell

                cell = fileRow.insertCell()
                cell.innerHTML = '\
<button id="' + value.id + '-error"   class="tool-icon tool-error   " title="Errors"        onclick="showNodeErrors(this)">&#9888;</button>'
                value.err_but = document.getElementById(value.id + "-error")

                cell = fileRow.insertCell()
                cell.innerHTML = '\
<button id="' + value.id + '-link"    class="tool-icon tool-link    " title="Open Schematic" onclick="openNodeLink(this)">&#11179;</button>'
            }

            // After all folders are populated it's time to link subfolders to their parents
            foldersList.forEach(folderPath => {
                let parentPath = folderPath
                while (parentPath.length > 0) {
                    parentPath = parentPath.split('/').slice(0, -1).join('/')
                    if (folders[parentPath] == undefined) {
                        continue
                    }
                    folders[folderPath].folder = folders[parentPath]
                    folders[parentPath].folders[folderPath] = folders[folderPath]
                    break
                }
            })
        }

        function parentIsCollapsed(node, filters) {
            if (node.folder == null) {
                return false;
            } else {
                if (filters.path == node.folder.path || (filters.path.length > 0 && filters.path[0] != "/")) {
                    return false;
                } else if (!node.folder.expanded) {
                    return true;
                } else {
                    return parentIsCollapsed(node.folder, filters)
                }
            }
        }

        const fileStatus = ["outdate", "flocked", "locked", "added", "modified", "removed", "renamed",]
        const fileStatusChanged = ["added", "modified", "removed", "renamed",]

        function updateAttributes(filez, folders) {
            // Reset then update folder statuses
            for (const [folderPath, value] of Object.entries(folders)) {
                value.attributes = { "status": {}, "folder-expanded": "true", "fav": "folder", "errors": [], "modified": [] }
                // Apply expanded property only, other are defined by files
                if (!value.expanded) {
                    value.attributes["folder-expanded"] = "false"
                }
            }
            // Reset then update files statuses and statuses of their folders
            for (const [filePath, value] of Object.entries(filez)) {
                value.attributes = { "status": {}, "file-open": "false", "fav": "false", "errors": [] }
                if (value.open) {
                    value.attributes["file-open"] = "true"
                }
                if (value.fav) {
                    value.attributes.fav = "true"
                    value.folder.attributes.fav = "true"
                }
                let ch = false
                fileStatus.forEach(stat => {
                    if (value[stat]) {
                        value.attributes.status[stat] = true
                        value.folder.attributes.status[stat] = true
                        if (!ch && fileStatusChanged.indexOf(stat) >= 0) {
                            ch = true
                            value.attributes.status["changes"] = true
                            value.folder.attributes.status["changes"] = true
                            value.folder.attributes.modified.push(filePath)
                        }
                    }
                })
                let err = false
                if (value.errors !== undefined && value.errors !== null && value.errors.length > 0) {
                    value.attributes.status.errors = true
                    value.folder.attributes.status.errors = true
                    value.attributes.errors = value.attributes.errors.concat(value.errors)
                    value.folder.attributes.errors.push(filePath)
                    err = true
                }
                if (value.outdate) {
                    value.attributes.status.errors = true
                    value.folder.attributes.status.errors = true
                    value.attributes.errors.push("Source changed on server")
                    if (!err) {
                        value.folder.attributes.errors.push(filePath)
                    }
                }
            }
            // Propagate folder's statuses to parents
            // Start from leaf folders
            let currentFolders = []
            for (const [folderPath, value] of Object.entries(folders)) {
                if ((Object.keys(value.folders)).length > 0) {
                    // skip non leaf folders
                    continue
                }
                currentFolders.push(value)
            }
            // Walk up to the root aggregating stats along the way
            while (currentFolders.length > 0) {
                let parentFolders = []
                currentFolders.forEach(current => {
                    let parent = current.folder
                    if (parent !== undefined && parent !== null) {

                        fileStatus.forEach(stat => {
                            if (current.attributes.status[stat]) {
                                parent.attributes.status[stat] = true
                            }
                        })
                        if (current.attributes.fav == "true") {
                            if (parent.attributes.fav == "folder") {
                                parent.attributes.fav = "nested"
                            }
                        }
                        if (current.attributes.errors.length > 0) {
                            parent.attributes.errors = parent.attributes.errors.concat(current.attributes.errors)
                        }
                        parentFolders.push(current.folder)
                    }
                })
                currentFolders = parentFolders
            }
        }

        function applyAttributes(node) {
            if (node.row === undefined && node.row === null) {
                return
            }
            if (node.attributes !== undefined) {
                for (const [attr, value] of Object.entries(node.attributes)) {
                    if (attr == "status") {
                        node.row.setAttribute("data-status", Object.keys(value).join(" "))
                        node.stat_but.title = Object.keys(value).join("\n") // TODO: describe status better
                    } else if (attr == "errors") {
                        if (value.length > 0) {
                            node.row.setAttribute("data-errors", "true")
                            node.err_but.title = value.join("\n")
                        } else {
                            node.row.setAttribute("data-errors", "false")
                        }
                    } else if (attr == "modified") {
                        node.stat_but.title = value.join("\n")
                    } else {
                        node.row.setAttribute("data-" + attr, value)
                    }
                    if (node.attributes.fav == "false") {
                        node.fav_cell.classList.add("no-fav")
                    } else {
                        node.fav_cell.classList.remove("no-fav")
                    }
                }
            }
        }

        function refreshView(filez, folders, filters) {
            updateAttributes(filez, folders)
            for (const [filePath, value] of Object.entries(filez)) {
                if (!value.visible || (!filters.folders && (!value.folder.visible || parentIsCollapsed(value, filters)))) {
                    value.row.classList.add("hidden")
                    value.row.classList.remove("shown")
                } else {
                    value.row.classList.add("shown")
                    value.row.classList.remove("hidden")
                    applyAttributes(value)
                }
            }
            for (const [folderPath, value] of Object.entries(folders)) {
                if (value.row !== undefined) {
                    if ((filters.folders || !value.visible || parentIsCollapsed(value, filters)) && filters.path != value.path) {
                        value.row.classList.add("hidden")
                        value.row.classList.remove("shown")
                    } else {
                        value.row.classList.add("shown")
                        value.row.classList.remove("hidden")
                        applyAttributes(value)
                    }
                }
            }
        }

        const PathStartsWidth = 0
        const PathContains = 1
        const PathAny = -1

        function pathMatch(matchType, path, pattern) {
            return matchType == PathAny
                || (matchType == PathStartsWidth && path.startsWith(pattern.substring(1)))
                || (matchType == PathContains && path.search(pattern) >= 0)
        }

        const filterStraight = ["locked", "flocked", "open", "fav", "outdate"]

        function updateFilter(filez, folders, filter) {
            if (true) {
                const matchType = filter.path === undefined || filter.path === "" ? PathAny :
                    filter.path[0] == "^" ? PathStartsWidth : PathContains
                for (const [filePath, value] of Object.entries(filez)) {
                    let show = !filter.union;
                    filterStraight.forEach(field => {
                        if (filter[field] !== undefined) {
                            if (filter.union) {
                                show |= (value[field] == filter[field])
                            } else {
                                show &= (value[field] == filter[field])
                            }
                        }
                    })

                    if (((show && !filter.union) || (!show && filter.union)) && filter.errors) {
                        if (!filter.union) {
                            if (value.errors === undefined || value.errors === null || value.errors.length == 0) {
                                show = false
                            }
                        } else {
                            if (value.errors !== undefined && value.errors !== null && value.errors.length > 0) {
                                show = true
                            }
                        }
                    }

                    if (((show && !filter.union) || (!show && filter.union)) && filter.changed) {
                        if (filter.union) {
                            show |= value.added | value.modified | value.removed | value.renamed
                        } else {
                            show &= value.added | value.modified | value.removed | value.renamed
                        }
                    }

                    if (show) {
                        show &= pathMatch(matchType, filePath, filter.path)
                    }
                    value.visible = show
                }
                for (const [folderPath, value] of Object.entries(folders)) {
                    value.visible = false
                    for (const [filePath, fileValue] of Object.entries(value.filez)) {
                        if (fileValue.visible) {
                            value.visible = true
                            break
                        }
                    }
                }
            }

            refreshView(filez, folders, filter)
        }

        function onFilterPathChange(value) {
            filesFilter.path = value
            updateFilter(filez, folders, filesFilter)
        }

        function createOption(selector, text, value) {
            let opt = document.createElement("option");
            opt.value = value;
            opt.text = text;
            selector.options.add(opt);
        }
    </script>

    <div id="domainsSelector">
        Data domain: <select id="domains" class="tool" onchange="console.log(this.value)"></select>
    </div>

    <div id="filesBrowserPlaceholder">
        <table class="tool" id="filesBrowser">
            <thead>
                <tr>
                    <th><button id="but-collapse" title="Expand All" class="tool-icon"
                            style="color:rgba(0,0,0,0); background-color: rgba(0,0,0,0);">&#128449;</button></th>
                    <th>Path Filter</th>
                    <th></th>
                    <th id="th-toolbox" style="color: rgba(0,0,0,0); font-weight: normal; font-style: italic;"></th>
                    <th></th>
                    <th></th>
                    <th>Link</th>
                </tr>
                <tr id="filtersRow" data-path="all" data-folder-expanded="false" data-filter-changed="false"
                    data-dont-display-folders="false" data-filter-open="false" data-filter-locked="false"
                    data-filter-flocked="false" data-filter-outdate="false" data-filter-union="false"
                    data-filter-fav="false" data-filter-errors="false">
                    <th>
                        <button id="but-collapse" title="Expand All" class="tool-icon f-theme tool-icon-folder"
                            onclick="toggleAllFolder(this)"></button>
                    </th>
                    <th>
                        <span id="filePathFilterStatic">
                            <!-- TODO: fill-in with static path like shown below
                            <button class="tool b-but tool-folder-static-path">/folder1</button>
                            <button class="tool b-but tool-folder-static-path">/sub1</button>
                            -->
                        </span>
                        <input id="filePathFilter" title="File path filter" class="tool" value=""
                            onchange="onFilterPathChange(this.value)" onkeyup="onFilterPathChange(this.value)"
                            onkeypress="if (event.keyCode == 13) {return false}"></input>
                    </th>
                    <th>
                        <button id="but-filterChanged" title="Show changed only"
                            class="tool bf-t tool-filter-changed-color"
                            onclick="toggleFilter('changed', 'data-filter-changed')">&#9679;</button>
                    </th>
                    <th>
                        <!-- TODO: HidePath in names:   Path\ -->
                        <!-- TODO: SortByName: A-z z-A -->
                        <!-- TODO: SortByDate: &#128467; &#8645; &#8613; &#8615; -->
                        <button id="but-dontDisaplyFolders" title="Don't display folders"
                            class="tool-icon tool-dont-display-folders"
                            onclick="toggleFilter('folders', 'data-dont-display-folders')">&#128448;</button>
                        <button id="but-filterOpen" title="Show open files only"
                            class="tool-icon tool-filter-open-color"
                            onclick="toggleFilter('open', 'data-filter-open')">&#128441;</button>
                        <button id="but-filterLocked" title="Show locked files only"
                            class="tool-icon tool-filter-locked-color"
                            onclick="toggleFilter('locked', 'data-filter-locked')">&#9919;</button>
                        <button id="but-filterFlocked" title="Show f-locked files only"
                            class="tool-icon tool-filter-flocked-color"
                            onclick="toggleFilter('flocked', 'data-filter-flocked')">&#9919;</button>
                        <button id="but-filterOutdate" title="Show outdated files only"
                            class="tool-icon tool-filter-outdate-color"
                            onclick="toggleFilter('outdate', 'data-filter-outdate')">&#10226;</button>
                        <button id="but-filterUnion" title="Join filtered" class="tool-icon tool-filter-union-color"
                            onclick="toggleFilter('union', 'data-filter-union')">&#10756;</button>
                    </th>
                    <th>
                        <button id="but-filterStarred" title="Show starred only" class="tool-icon tool-filter-fav-color"
                            onclick="toggleFilter('fav', 'data-filter-fav')">&#9733;</button>
                    </th>
                    <th>
                        <button id="but-filterErrors" title="Show errors only"
                            class="tool-icon tool-filter-errors-color"
                            onclick="toggleFilter('errors', 'data-filter-errors')">&#9888;</button>
                    </th>
                    <th><select id="viewer" title="Tool to show schematic" class="tool"
                            onchange="console.log(this.value)">
                            <option>HDELK</option>
                            <option>D3HW</option>
                        </select> </th>
                </tr>
            </thead>
            <tbody id="filesList">
            </tbody>
        </table>
    </div>

    <script>
        ["demo", "test"].forEach(item => {
            createOption(document.getElementById("domains"), item, item)
        })

        document.getElementById("domains").value = "test"
        // NOTE: this date produces longest text and is used to set size for node-info column
        const special_date = new Date()
        special_date.setFullYear(2022)
        special_date.setMonth(11)
        special_date.setDate(30)
        special_date.setHours(22)
        special_date.setMinutes(59)
        special_date.setSeconds(59)
        document.getElementById("th-toolbox").innerHTML = special_date.toLocaleString()

        populate(document.getElementById("filesBrowser"), filez, folders)
        updateFilter(filez, folders, filesFilter)
    </script>

</body>

</html>
