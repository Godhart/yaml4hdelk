<!DOCTYPE html>
<html>

<head>
</head>

<body>
    <script>
        class Ps {
            value = ""

            p1 = function (arg1) {
                return new Promise((resolve, reject) => {
                    resolve(arg1 + "-p1")
                })
            }

            p2 = function (arg1) {
                return new Promise((resolve, reject) => {
                    resolve(arg1 + "-p2")
                })
            }

            pX = function (arg1, arg2) {
                return new Promise((resolve, reject) => {
                    if (arg2 == "Y") {
                        reject("No Y!")
                    }
                    resolve(arg1 + "-p" + arg2)
                })
            }

            pY = function(arg1, arg2){
                return new Promise((resolve, reject) => {resolve(true)})
                .then(
                    _ => this.pX(arg1, arg2),
                    err => {throw Error(err)}
                )
            }

            pZ = function(arg1, arg2){
                return this.pX(arg1, arg2)
            }

            constructor(value, value2) {
                this.ifCreated = new Promise((resolve, reject) => {
                    this.p1(value)
                        .then(vp1 => this.p2(vp1))
                        .then(vp2 => {return vp2+"-inline1"})
                        .then((inline1) => {
                            inline1 += "-inline2"
                            return this.pX(inline1, value2) // NOTE: rejected if value2 = "Y"
                        })
                        .then(vpX => this.value = vpX)
                        .then(_ => resolve(true),
                            err => reject(err)
                            // NOTE: final then SHOULD contain reject handling
                            // otherwise uncaught exception if some of promises above rejected (.pX in this example)
                        )
                })
            }
        }

        const iPsX = new Ps("A", "X")
        const iPsY = new Ps("A", "Y")

    </script>
    <div id="xxx"></div>
    <div id="yyy"></div>

    <script>
        iPsX.ifCreated
            .then(_ => document.getElementById("xxx").innerHTML = "" + iPsX.value)
            .finally(console.log("Fin X!"))
        iPsY.ifCreated
            .then(_ => document.getElementById("yyy").innerHTML = "" + iPsY.value,
                err => document.getElementById("yyy").innerHTML = "" + err)
            .finally(console.log("Fin Y!"))

        iPsX.pX("B","Y").then(
            _ => console.log("B-OK"),
            _ => console.log("B-err "+_)
        )

        iPsX.pY("C","Y").then(
            _ => console.log("C-OK"),
            _ => console.log("C-err "+_)
        )

        iPsX.pZ("D","Y").then(
            _ => console.log("D-OK"),
            _ => console.log("D-err "+_)
        )

    </script>

</body>

</html>
